// Tri-State Input Binding
// ========================
// A custom Shiny input that cycles through three states.
//
// YOUR TASK: Complete the methods marked with "YOUR CODE HERE"
//
// The HTML structure (generated by R) looks like this:
//
//   <div id="inputId" class="tri-state-input" data-selected="all">
//     <label class="tri-state-label">Show tasks:</label>
//     <div class="tri-state-options">
//       <button class="tri-state-option active" data-value="all">All</button>
//       <button class="tri-state-option" data-value="active">Active</button>
//       <button class="tri-state-option" data-value="completed">Completed</button>
//     </div>
//   </div>

// Create a new input binding object
var triStateBinding = new Shiny.InputBinding();

// Extend it with our implementation
$.extend(triStateBinding, {

  // =========================================================================
  // REQUIRED METHOD: find(scope)
  // =========================================================================
  // Purpose: Locate all instances of this input type within the given scope
  // Parameter: scope - Usually the document, but can be a smaller DOM section
  // Returns: A jQuery object containing all matching elements
  //
  // HINT: Use $(scope).find() with a CSS class selector
  // The container div has class "tri-state-input"
  //
  find: function(scope) {
    // YOUR CODE HERE
    // Return all elements with class 'tri-state-input'

  },

  // =========================================================================
  // REQUIRED METHOD: getValue(el)
  // =========================================================================
  // Purpose: Extract and return the current value to send to R
  // Parameter: el - The DOM element (the container div with class tri-state-input)
  // Returns: The value that will be available as input$inputId in R
  //
  // HINT: The current selection is stored in the data-selected attribute
  // You can access it with $(el).data('selected') or $(el).attr('data-selected')
  //
  // IMPORTANT: You MUST have a return statement or the binding fails silently!
  //
  getValue: function(el) {
    // YOUR CODE HERE
    // Return the current selected value from the data-selected attribute

  },

  // =========================================================================
  // REQUIRED METHOD: subscribe(el, callback)
  // =========================================================================
  // Purpose: Set up event listeners to detect when the value changes
  // Parameters:
  //   el - The DOM element
  //   callback - Function to call when value changes (notifies Shiny)
  //
  // When a user clicks an option button, you need to:
  //   1. Get the value from the clicked button's data-value attribute
  //   2. Update the data-selected attribute on the container
  //   3. Update visual state (remove 'active' class from all, add to clicked)
  //   4. Call callback() to notify Shiny
  //
  // HINT: Use event delegation with $(el).on('click.triStateBinding', '.tri-state-option', ...)
  // The namespace (.triStateBinding) helps with clean unsubscription later
  //
  // IMPORTANT: Also add a listener for 'change' events so that receiveMessage
  // can trigger updates. Use: $(el).on('change.triStateBinding', function() { callback(); });
  //
  subscribe: function(el, callback) {
    // YOUR CODE HERE
    // 1. Attach a click handler to the option buttons
    // 2. When clicked:
    //    - Get the clicked button's data-value
    //    - Update $(el).data('selected', value)
    //    - Remove 'active' class from all options
    //    - Add 'active' class to clicked option
    //    - Call callback() to notify Shiny
    // 3. Also attach a change handler to notify Shiny when receiveMessage triggers

  },

  // =========================================================================
  // CLEANUP METHOD: unsubscribe(el)
  // =========================================================================
  // Purpose: Remove event handlers when element is removed from DOM
  // This prevents memory leaks
  //
  // This one is done for you!
  //
  unsubscribe: function(el) {
    $(el).off('.triStateBinding');
  },

  // =========================================================================
  // OPTIONAL METHOD: setValue(el, value)
  // =========================================================================
  // Purpose: Programmatically set the input's value
  // This is used by receiveMessage when R calls updateTriStateInput()
  //
  // Parameters:
  //   el - The DOM element
  //   value - The new value to set
  //
  // HINT: Similar to what you do in subscribe, but without the click event
  //
  setValue: function(el, value) {
    // YOUR CODE HERE
    // 1. Update $(el).data('selected', value)
    // 2. Update the data-selected attribute: $(el).attr('data-selected', value)
    // 3. Remove 'active' class from all options
    // 4. Add 'active' class to the option with matching data-value

  },

  // =========================================================================
  // OPTIONAL METHOD: receiveMessage(el, data)
  // =========================================================================
  // Purpose: Handle messages sent from R via session$sendInputMessage()
  // This is called when R executes updateTriStateInput()
  //
  // Parameters:
  //   el - The DOM element
  //   data - Object sent from R (contains 'selected' property)
  //
  receiveMessage: function(el, data) {
    // YOUR CODE HERE
    // 1. Check if data has a 'selected' property
    // 2. If so, call this.setValue(el, data.selected)
    // 3. Trigger a change event: $(el).trigger('change')

  },

  // =========================================================================
  // OPTIONAL METHOD: getRatePolicy()
  // =========================================================================
  // Purpose: Control how often updates are sent to R
  // Returns: Object with 'policy' and 'delay' properties
  //
  // Policies:
  //   'direct' - Send immediately (no rate limiting)
  //   'debounce' - Wait until no new values for 'delay' ms (good for typing)
  //   'throttle' - Send at most once per 'delay' ms (good for sliders)
  //
  // This one is done for you!
  //
  getRatePolicy: function() {
    return { policy: 'debounce', delay: 250 };
  }

});

// Register the binding with Shiny
// The second argument is a unique identifier (usually package.bindingName)
Shiny.inputBindings.register(triStateBinding, 'workshop.triStateInput');
