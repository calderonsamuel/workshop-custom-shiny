// Stat Card Output Binding
// ========================
// A custom Shiny output that displays metrics with conditional styling.
//
// YOUR TASK: Complete the methods marked with "YOUR CODE HERE"
//
// Output bindings are simpler than input bindings!
// You only need to implement two methods: find() and renderValue()
//
// The HTML structure (generated by R) looks like this:
//
//   <div id="outputId" class="stat-card" style="width: 200px;">
//     <div class="stat-title">Loading...</div>
//     <div class="stat-value">--</div>
//   </div>
//
// The data sent from R (via renderStatCard) looks like:
//   { title: "Performance Score", value: 75, status: "warning" }
//
// Status can be: "good", "warning", or "bad"
// These correspond to CSS classes: status-good, status-warning, status-bad

// Create a new output binding object
var statCardBinding = new Shiny.OutputBinding();

// Extend it with our implementation
$.extend(statCardBinding, {

  // =========================================================================
  // REQUIRED METHOD: find(scope)
  // =========================================================================
  // Purpose: Locate all instances of this output type within the given scope
  // Parameter: scope - Usually the document, but can be a smaller DOM section
  // Returns: A jQuery object containing all matching elements
  //
  // HINT: Use $(scope).find() with a CSS class selector
  // The container div has class "stat-card"
  //
  find: function(scope) {
    // YOUR CODE HERE
    // Return all elements with class 'stat-card'

  },

  // =========================================================================
  // REQUIRED METHOD: renderValue(el, data)
  // =========================================================================
  // Purpose: Update the DOM element with data received from R
  // Parameters:
  //   el - The DOM element (the container div with class stat-card)
  //   data - Object sent from R containing: { title, value, status }
  //
  // You need to:
  //   1. Handle the case where data is null (no data yet)
  //   2. Update the .stat-title element with data.title
  //   3. Update the .stat-value element with data.value
  //   4. Remove any existing status classes (status-good, status-warning, status-bad)
  //   5. Add the appropriate status class based on data.status
  //
  // HINTS:
  //   - Use $(el).find('.stat-title').text(data.title) to set text
  //   - Use $(el).removeClass('status-good status-warning status-bad') to clear
  //   - Use $(el).addClass('status-' + data.status) to add the new class
  //
  renderValue: function(el, data) {
    // YOUR CODE HERE

    // Step 1: Handle null data
    // if (data === null) {
    //   ... set title to 'No data', value to '--', remove status classes
    //   return;
    // }

    // Step 2: Set the title text

    // Step 3: Set the value text

    // Step 4: Remove all status classes

    // Step 5: Add the new status class (if data.status exists)

  },

  // =========================================================================
  // OPTIONAL METHOD: renderError(el, error)
  // =========================================================================
  // Purpose: Display an error message when R throws an error
  // This one is done for you!
  //
  renderError: function(el, error) {
    $(el).find('.stat-title').text('Error');
    $(el).find('.stat-value').text(error.message);
    $(el).removeClass('status-good status-warning status-bad');
    $(el).addClass('status-bad');
  },

  // =========================================================================
  // OPTIONAL METHOD: clearError(el)
  // =========================================================================
  // Purpose: Clear the error state when rendering succeeds again
  // This one is done for you!
  //
  clearError: function(el) {
    $(el).removeClass('status-bad');
  }

});

// Register the binding with Shiny
// The second argument is a unique identifier (usually package.bindingName)
Shiny.outputBindings.register(statCardBinding, 'workshop.statCardOutput');
